<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>{getTBinR}</title>
    <meta charset="utf-8" />
    <meta name="author" content="Sam Abbott (@seabbs)" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# <code>{getTBinR}</code>
## An R package for accessing and summarising the World Health Organization Tuberculosis data
### Sam Abbott (<span class="citation">@seabbs</span>)
### University of Bristol
### 2019/09/14

---

class: inverse



# Outline

0. Overview

1. Why

2. What

3. How

4. Can I do that?

---
class: center, middle, inverse

# Overview

---
# Overview

---
class: center, middle, inverse

# Why

---

# Why data access packages

---

# Why does Tuberculosis matter


--- 

# Why the addition of tools for working with the data

---
class: center, middle, inverse

# What

---

# World Health Organisation TB data

The WHO provide multiple cleaned datasets via their website. They also have a backend API through which other datasets can be accessed, although these tend to be far from tidy. All analysis ready datasets come with a complete data dictionary.

![](img/who-data.png)&lt;!-- --&gt;

---

# Getting the WHO TB burden data

Get the WHO TB burden data.

```r
tb_burden &lt;- getTBinR::get_tb_burden(verbose = FALSE)
```

Inspect the data.

```r
print(tb_burden, n = 3, n_extra = 10)
```

```
## # A tibble: 3,850 x 68
##   country iso2  iso3  iso_numeric g_whoregion  year e_pop_num e_inc_100k
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;       &lt;int&gt;     &lt;int&gt;      &lt;dbl&gt;
## 1 Afghan… AF    AFG             4 Eastern Me…  2000  20093756        190
## 2 Afghan… AF    AFG             4 Eastern Me…  2001  20966463        189
## 3 Afghan… AF    AFG             4 Eastern Me…  2002  21979923        189
## # … with 3,847 more rows, and 60 more variables: e_inc_100k_lo &lt;dbl&gt;,
## #   e_inc_100k_hi &lt;dbl&gt;, e_inc_num &lt;int&gt;, e_inc_num_lo &lt;int&gt;,
## #   e_inc_num_hi &lt;int&gt;, e_tbhiv_prct &lt;dbl&gt;, e_tbhiv_prct_lo &lt;dbl&gt;,
## #   e_tbhiv_prct_hi &lt;dbl&gt;, e_inc_tbhiv_100k &lt;dbl&gt;,
## #   e_inc_tbhiv_100k_lo &lt;dbl&gt;, …
```

---

# Getting the WHO TB burden data

Inspect variables.


```r
names(tb_burden)
```

```
##  [1] "country"                  "iso2"                    
##  [3] "iso3"                     "iso_numeric"             
##  [5] "g_whoregion"              "year"                    
##  [7] "e_pop_num"                "e_inc_100k"              
##  [9] "e_inc_100k_lo"            "e_inc_100k_hi"           
## [11] "e_inc_num"                "e_inc_num_lo"            
## [13] "e_inc_num_hi"             "e_tbhiv_prct"            
## [15] "e_tbhiv_prct_lo"          "e_tbhiv_prct_hi"         
## [17] "e_inc_tbhiv_100k"         "e_inc_tbhiv_100k_lo"     
## [19] "e_inc_tbhiv_100k_hi"      "e_inc_tbhiv_num"         
## [21] "e_inc_tbhiv_num_lo"       "e_inc_tbhiv_num_hi"      
## [23] "e_mort_exc_tbhiv_100k"    "e_mort_exc_tbhiv_100k_lo"
## [25] "e_mort_exc_tbhiv_100k_hi" "e_mort_exc_tbhiv_num"    
## [27] "e_mort_exc_tbhiv_num_lo"  "e_mort_exc_tbhiv_num_hi" 
## [29] "e_mort_tbhiv_100k"        "e_mort_tbhiv_100k_lo"    
## [31] "e_mort_tbhiv_100k_hi"     "e_mort_tbhiv_num"        
## [33] "e_mort_tbhiv_num_lo"      "e_mort_tbhiv_num_hi"     
## [35] "e_mort_100k"              "e_mort_100k_lo"          
## [37] "e_mort_100k_hi"           "e_mort_num"              
## [39] "e_mort_num_lo"            "e_mort_num_hi"           
## [41] "cfr"                      "cfr_lo"                  
## [43] "cfr_hi"                   "c_newinc_100k"           
## [45] "c_cdr"                    "c_cdr_lo"                
## [47] "c_cdr_hi"                 "source_rr_new"           
## [49] "source_drs_coverage_new"  "source_drs_year_new"     
## [51] "e_rr_pct_new"             "e_rr_pct_new_lo"         
## [53] "e_rr_pct_new_hi"          "e_mdr_pct_rr_new"        
## [55] "source_rr_ret"            "source_drs_coverage_ret" 
## [57] "source_drs_year_ret"      "e_rr_pct_ret"            
## [59] "e_rr_pct_ret_lo"          "e_rr_pct_ret_hi"         
## [61] "e_mdr_pct_rr_ret"         "e_inc_rr_num"            
## [63] "e_inc_rr_num_lo"          "e_inc_rr_num_hi"         
## [65] "e_mdr_pct_rr"             "e_rr_in_notified_pulm"   
## [67] "e_rr_in_notified_pulm_lo" "e_rr_in_notified_pulm_hi"
```

---

# Getting the WHO TB data dictionary

Get the WHO TB data dictionary.


```r
tb_dict &lt;- getTBinR::get_data_dict()
```

```
## Loading data from: /tmp/Rtmp6HJcLF/dictionary.rds
```

Inspect the dimensions.

```r
dim(tb_dict)
```

```
## [1] 470   4
```

Inspect variables.

```r
names(tb_dict)
```

```
## [1] "variable_name" "dataset"       "code_list"     "definition"
```

---
class: center, middle, inverse

# Exploring getTBinR functionality

---

# Search for a variable


```r
vars_of_interest &lt;- getTBinR::search_data_dict(var = c("e_inc_100k"),
                                               def = "incidence")
```

```
## Loading data from: /tmp/Rtmp6HJcLF/dictionary.rds
```

```
## 1 results found for your variable search for e_inc_100k
```

```
## 12 results found for your definition search for incidence
```

---

# Search Result


```r
kable(vars_of_interest, "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; variable_name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; dataset &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; code_list &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; definition &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_100k &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence (all forms) per 100 000 population &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_100k_hi &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence (all forms) per 100 000 population, high bound &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_100k_lo &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence (all forms) per 100 000 population, low bound &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_rr_num &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of rifampicin resistant TB (absolute number) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_rr_num_hi &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of rifampicin resistant TB (absolute number): high bound &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_rr_num_lo &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of rifampicin resistant TB (absolute number): low bound &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_tbhiv_100k &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of TB cases who are HIV-positive per 100 000 population &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_tbhiv_100k_hi &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of TB cases who are HIV-positive per 100 000 population, high bound &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_tbhiv_100k_lo &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of TB cases who are HIV-positive per 100 000 population, low bound &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_tbhiv_num &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of TB cases who are HIV-positive &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_tbhiv_num_hi &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of TB cases who are HIV-positive, high bound &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_inc_tbhiv_num_lo &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimates &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Estimated incidence of TB cases who are HIV-positive, low bound &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# Map Global Incidence Rates


```r
getTBinR::map_tb_burden(metric = "e_inc_100k", verbose = FALSE, interactive = FALSE)
```

![](presentation_files/figure-html/map-global-inc-1.svg)&lt;!-- --&gt;

---

# Get 10 countries with highest incidence rates in 2016


```r
high_inc_countries &lt;- tb_burden %&gt;% 
  filter(year == 2016) %&gt;% 
  group_by(country) %&gt;% 
  summarise(e_inc_100k = max(e_inc_100k)) %&gt;% 
  ungroup %&gt;% 
  arrange(desc(e_inc_100k)) %&gt;% 
  slice(1:10) %&gt;% 
  pull(country) %&gt;% 
  unique
```

---

# 10 countries with highest incidence rates in 2016


```r
high_inc_countries
```

```
##  [1] "Lesotho"                              
##  [2] "South Africa"                         
##  [3] "Kiribati"                             
##  [4] "Philippines"                          
##  [5] "Mozambique"                           
##  [6] "Gabon"                                
##  [7] "Democratic People's Republic of Korea"
##  [8] "Timor-Leste"                          
##  [9] "Namibia"                              
## [10] "Papua New Guinea"
```

---

# Overview of TB incidence rates

For the countries with the 10 highest incidence rates


```r
getTBinR::plot_tb_burden_overview(metric = "e_inc_100k", countries = high_inc_countries,
                                  verbose = FALSE)
```

![](presentation_files/figure-html/plot-tb-inc-overview-1.svg)&lt;!-- --&gt;
---

# Trends over time in TB incidence rates

For the countries with the 10 highest incidence rates


```r
plot_tb_burden(metric = "e_inc_100k",  
               countries = high_inc_countries,
               facet = "country", scales = "free_y",
               verbose = FALSE)
```

![](presentation_files/figure-html/plot-inc--by-country-1.svg)&lt;!-- --&gt;

---

# For non R users

getTBinR has a built in `shiny` dashboard which can be run locally using `getTBinR::run_tb_dashboard()`. Alternatively there is a [hosted version](http://www.seabbs.co.uk/shiny/ExploreGlobalTB/). 

![](img/ExploreGlobalTB.png)&lt;!-- --&gt;
---
class: center, middle, inverse

# Package Structure

---

# Documentation

Documentation is built using `roxygen`, this is then used to generate a package website using `pkgdown`. See [here](https://github.com/seabbs/getTBinR/blob/master/_pkgdown.yml) for the yaml and [here](https://www.samabbott.co.uk/getTBinR/index.html) for the site.

![](img/pkgdown_site.png)&lt;!-- --&gt;

---

# Testing

- Unit tests are implemented using the `testthat` package. 

- The package is then tested on Linux and Mac using [Travis](https://travis-ci.com/), and on Windows using [AppVeyor](https://ci.appveyor.com/login). See [here](https://github.com/seabbs/getTBinR/tree/master/tests/testthat) for tests, [here](https://github.com/seabbs/getTBinR/blob/master/.travis.yml) for travis set-up , and [here] for [here](https://github.com/seabbs/getTBinR/blob/master/appveyor.yml) Appveyor set-up.

- Code coverage is then checked using [Codecov](https://codecov.io/github/seabbs/getTBinR?branch=master). 

Example test:


```r
test_that("TB burden data is the same when downloaded using utils::read.csv", {
  tb_data_utils &lt;- get_tb_burden(download_data = TRUE,
                                 use_utils = TRUE,
                                 burden_save_name = "TB_with_utils")
  
  skip_on_cran()
  expect_equal(tb_data, tb_data_utils)
})
```

---
class: center, middle, inverse

# Outreach

---

# Blog posts

I have written several blog posts which have then be editted into vignettes, see [here](https://www.samabbott.co.uk/tags/who/)

![](img/blog.png)&lt;!-- --&gt;

---

# Gists and Tweets

Gists [here](https://gist.github.com/seabbs) and twitter [here](https://twitter.com/seabbs).

![](img/gists.png)&lt;!-- --&gt;

---
class: center, middle, inverse

# Planned Funtionality

---

# Issues

Currently planned functionality has been outlined in the GitHub issues, found [here](https://github.com/seabbs/getTBinR/issues).

![](img/issues.png)&lt;!-- --&gt;

---

class: inverse, center, middle

# Thanks for listening

## Slides: http://bit.ly/getTBinR-r-medicine

## Paper: http://bit.ly/getTBinR-paper

## Documentation: http://bit.ly/getTBinR

## Personal Website: http://bit.ly/seabbs

## Tweet at me: [@seabbs](https://twitter.com/seabbs)

---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
